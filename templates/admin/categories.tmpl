<!--
  vim: filetype=html
-->
{{template "admin" .}}
{{define "content"}}
<div class="management">
  <div class="management-header">
    <h1>Category Management</h1>
  </div>

  <button class="btn btn-primary" onclick="showCategoryModal(null)">
    <i class="fas fa-plus"></i> Add Root Category
  </button>

  <div class="category-tree">
    {{ template "category_item" .Categories }}
  </div>
</div>

<!-- Category Modal -->
<div class="category-modal" id="categoryModal">
  <div class="modal-content">
    <span class="close" onclick="closeCategoryModal()">&times;</span>
    <h3 id="modalTitle">New Category</h3>
    <form id="categoryForm">
      <input type="hidden" id="categoryId">
      <input type="hidden" id="parentId">

      <div class="form-group">
        <label>Category Name</label>
        <input type="text" id="categoryName" class="form-control" required>
      </div>

      <div class="form-group">
        <label>Slug</label>
        <div class="slug-input-group">
          <input type="text" id="categorySlug" class="form-control" required>
          <button type="button" class="btn-slug-refresh" onclick="refreshSlug()">
            <i class="fas fa-sync-alt"></i>
          </button>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" onclick="closeCategoryModal()">Cancel</button>
        <button type="submit" class="btn btn-primary">Save</button>
      </div>
    </form>
  </div>
</div>

<!-- Delete Confirmation Dialog -->
<div id="deleteDialog" class="confirmation-dialog" style="display: none;">
  <p>Are you sure you want to delete this category?</p>
  <div style="margin-top: 15px; text-align: right;">
    <button class="btn btn-secondary" onclick="closeDialog()">Cancel</button>
    <button class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
  </div>
</div>
{{ end }}

{{ define "category_item" }}
<ul class="category-list">
  {{ range . }}
  <li class="category-item" data-id="{{ .ID }}" data-parent-id="{{ .ParentID }}">
    <div class="category-header">
      <span class="drag-handle">
        <i class="fas fa-grip-vertical"></i>
      </span>
      <span class="toggle" onclick="toggleChildren(this)">
        {{ if .Children }}<i class="fas fa-chevron-down toggle-icon"></i>{{ else }}<i class="fas fa-chevron-right toggle-icon"></i>{{ end }}
      </span>
      <span class="category-name">{{ .Name }}</span>
      <div class="category-actions">
        <button class="btn-icon" onclick="showCategoryModal('{{ .ID }}')">
          <i class="fas fa-plus"></i>
        </button>
        <button class="btn-icon" onclick="showEditModal({{ . }})">
          <i class="fas fa-edit"></i>
        </button>
        <button class="btn-icon btn-delete" onclick="confirmDelete({{ .ID }})">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    </div>
    <div class="category-children">
        <ul class="category-list">
            {{ if .Children }}
            {{ template "category_item" .Children }}
            {{ end }}
        </ul>
    </div>
  </li>
  {{ end }}
</ul>
{{ end }}
